
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Ignite Those Horrible Scripts - Aaron Kromer's Blog</title>
    <meta name="author" content="Aaron Kromer">
    
	<meta name="description" content="The past week was spent dealing with an infuriating data crunching task.
Chris and I decided to celebrate by killing our
poorly written Ruby cli &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Aaron Kromer's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-34364108-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<hgroup id="headerbg">
  <h1><a href="/">Aaron Kromer's Blog</a></h1>
  
    <h2>A little cup'a Kromer with your code</h2>
  
</hgroup>

<ul id="social-links">
  
  <!-- GitHub -->
  <li>
    <a href="https://github.com/cupakromer" title="GitHub">
      <i class="foundicon-github"></i>
    </a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
    <a href="http://www.twitter.com/cupakromer" title="Twitter">
      <i class="foundicon-twitter"></i>
    </a>
  </li>
  
  
  
  
  <li>
    <a href="/atom.xml">
      <i class="foundicon-rss"></i>
    </a>
  </li>
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
  <li id="ajax"><a href="/index.html">Home</a></li>
  <li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
  
  <li>
    <div id="dark">
      <form method="get" action="/search.html" id="search">
        <input name="query" type="text" placeholder="Search..." x-webkit-speech />
      </form>
    </div>
  </li>
  
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        <article class="post">
	<h2 class="title">Ignite Those Horrible Scripts</h2>
	<div class="entry-content"><p>The past week was spent dealing with an infuriating data crunching task.
<a href="https://twitter.com/crsexton">Chris</a> and I decided to celebrate by killing our
poorly written Ruby cli scripts with fire. Printing the scripts and going out
back to set them on fire would be more dramatic. Though it probably would be
appreciated by the other businesses which we share space with.</p>

<p>I took a breather and looked into <a href="http://www.zsh.org/">zsh</a> functions to
accomplish this. Here&#8217;s what I came up with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>rageflip<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">&quot; ‚îª‚îÅ‚îª Ô∏µ„ÉΩ(\`–î¬¥)ÔæâÔ∏µ ‚îª‚îÅ‚îª  $*&quot;</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>has_utility<span class="o">()</span> <span class="o">{</span> <span class="nb">hash</span> <span class="nv">$1</span> 2&gt;/dev/null <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Wrapper around `rm -rf` expressing callers loathing and disdain for the</span>
</span><span class='line'><span class="c"># provided files.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Inspiration was Homebrew&#39;s output:</span>
</span><span class='line'><span class="c"># üç∫  /usr/local/Cellar/tmux/1.9: 15 files, 628K, built in 25 seconds</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># For additional file stats, specific to code files, consider installing the</span>
</span><span class='line'><span class="c"># Count Lines of Code (cloc) tool: http://cloc.sourceforge.net/</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c">#   brew install cloc</span>
</span><span class='line'><span class="c">#   sudo apt-get install cloc</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'>ignite<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">((</span> <span class="nv">$# </span><span class="o">==</span> 0 <span class="o">))</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">&quot;USAGE: ignite file [file] ...&quot;</span>; <span class="k">return</span>; <span class="k">fi</span>
</span><span class='line'><span class="k">  </span><span class="nb">local </span>total_lines
</span><span class='line'>  <span class="nb">local </span>human_size
</span><span class='line'>  <span class="nb">local </span>lc_blank
</span><span class='line'>  <span class="nb">local </span>lc_comment
</span><span class='line'>  <span class="nb">local </span>lc_code
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;BURN IT ALL!!! $(rageflip)&quot;</span>
</span><span class='line'>  <span class="k">for </span>i <span class="k">do</span>
</span><span class='line'>    <span class="c"># If the file is empty we have 0 lines</span>
</span><span class='line'>    <span class="nv">human_size</span><span class="o">=</span><span class="k">$(</span>ls -lh <span class="nv">$i</span> | awk <span class="s1">&#39;{ print $5 }&#39;</span><span class="k">)</span>
</span><span class='line'>    <span class="nv">total_lines</span><span class="o">=</span><span class="k">${$(</span>sed -n <span class="s1">&#39;$=&#39;</span> <span class="nv">$i</span><span class="k">):-</span><span class="nv">0</span><span class="k">}</span>
</span><span class='line'>    <span class="nv">stats</span><span class="o">=</span><span class="s2">&quot;$total_lines lines&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if </span>has_utility cloc; <span class="k">then</span>
</span><span class='line'>      <span class="c"># Setup some local variables regarding file stats</span>
</span><span class='line'>      <span class="nv">lc_blank</span><span class="o">=</span>
</span><span class='line'>      <span class="nv">lc_comment</span><span class="o">=</span>
</span><span class='line'>      <span class="nv">lc_code</span><span class="o">=</span>
</span><span class='line'>      <span class="nb">eval</span> <span class="k">$(</span>
</span><span class='line'>        cloc <span class="nv">$i</span> --quiet | tail -2 | head -1 |
</span><span class='line'>        awk <span class="s1">&#39;{ print &quot;lc_blank=&quot;$3, &quot;lc_comment=&quot;$4, &quot;lc_code=&quot;$5 }&#39;</span>
</span><span class='line'>      <span class="k">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">[</span> ! -z <span class="nv">$lc_blank</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">        </span><span class="nv">stats</span><span class="o">=</span><span class="s2">&quot;$lc_code loc, $lc_comment comments, $lc_blank whitespace lines&quot;</span>
</span><span class='line'>      <span class="k">fi</span>
</span><span class='line'><span class="k">    fi</span>
</span><span class='line'>
</span><span class='line'><span class="k">    </span>rm -rf <span class="nv">$i</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;üî•  $i: $stats, $human_size&quot;</span>
</span><span class='line'>  <span class="k">done</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can sit back and watch it all burn:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>ignite script/crunch-*
</span><span class='line'>BURN IT ALL!!!  ‚îª‚îÅ‚îª Ô∏µ„ÉΩ<span class="o">(</span><span class="sb">`</span>–î¬¥<span class="o">)</span>ÔæâÔ∏µ ‚îª‚îÅ‚îª
</span><span class='line'>üî•  script/crunch-dump-sessions: 5 loc, 5 comments, 2 whitespace lines, 330B
</span><span class='line'>üî•  script/crunch-normalize: 47 loc, 14 comments, 11 whitespace lines, 2.2K
</span><span class='line'>üî•  script/crunch-import-csv: 101 loc, 2 comments, 20 whitespace lines, 2.7K
</span><span class='line'>üî•  script/crunch-timestamp: 203 loc, 44 comments, 38 whitespace lines, 8.4K
</span></code></pre></td></tr></table></div></figure>


<p>Though at this point, it might as well be a full script file. If I do that, I
might as well just write it as a Ruby cli&#8230;</p>
</div>

<div class="meta">
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



    </div>
    <footer id="footer">
    <div style="display:inline">
  <p>
    Copyright &copy; 2014

    Aaron Kromer
.
    All content on this site is available under a <a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0 license</a>.
  </p>
  <p>
    Powered by <a href="http://octopress.org">Octopress</a> |
    Theme based on <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
  </p>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
